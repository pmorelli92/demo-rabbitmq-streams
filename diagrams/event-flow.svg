<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <!-- White Background -->
  <rect width="100%" height="100%" fill="white"/>
  
  <defs>
    <style>
      .service-box { fill: #E3F2FD; stroke: #1976D2; stroke-width: 2; }
      .db-box { fill: #F3E5F5; stroke: #7B1FA2; stroke-width: 2; }
      .stream-box { fill: #E8F5E8; stroke: #388E3C; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .event-arrow { stroke: #FF6B35; stroke-width: 3; fill: none; marker-end: url(#eventarrow); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="eventarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#FF6B35" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="25" class="title" font-size="18">Event Flow: Customer → Stream → Order</text>
  
  <!-- Step 1: Customer Service -->
  <rect x="50" y="70" width="120" height="80" class="service-box" rx="10"/>
  <text x="110" y="95" class="title">Customer Service</text>
  <text x="110" y="115" class="text">API Endpoint</text>
  <text x="110" y="135" class="text">Business Logic</text>
  
  <!-- Customer DB -->
  <rect x="50" y="170" width="120" height="60" class="db-box" rx="5"/>
  <text x="110" y="195" class="title">Customer DB</text>
  <text x="110" y="215" class="text">Persistent Storage</text>
  
  <!-- Step 2: RabbitMQ Stream -->
  <rect x="240" y="70" width="120" height="160" class="stream-box" rx="10"/>
  <text x="300" y="95" class="title">RabbitMQ Stream</text>
  <text x="300" y="115" class="text">"customer"</text>
  
  <!-- Events in Stream -->
  <rect x="250" y="130" width="100" height="45" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1" rx="3"/>
  <text x="300" y="145" class="text" font-size="10">customer.created</text>
  <text x="300" y="160" class="text" font-size="10">customer.address.updated</text>
  
  <rect x="250" y="180" width="100" height="35" fill="#FFECB3" stroke="#FFC107" stroke-width="1" rx="3"/>
  <text x="300" y="195" class="text" font-size="10">Event Ordering</text>
  <text x="300" y="210" class="text" font-size="10">Durability</text>
  
  <!-- Step 3: Order Service -->
  <rect x="430" y="70" width="120" height="80" class="service-box" rx="10"/>
  <text x="490" y="95" class="title">Order Service</text>
  <text x="490" y="115" class="text">Event Consumer</text>
  <text x="490" y="135" class="text">Business Logic</text>
  
  <!-- Order DB -->
  <rect x="430" y="170" width="120" height="60" class="db-box" rx="5"/>
  <text x="490" y="195" class="title">Order DB</text>
  <text x="490" y="215" class="text">Customer Replica</text>
  
  <!-- Step 4: Order Processing -->
  <rect x="620" y="70" width="120" height="160" class="service-box" rx="10"/>
  <text x="680" y="95" class="title">Order Processing</text>
  <text x="680" y="115" class="text">POST /orders</text>
  <text x="680" y="135" class="text">Local Validation</text>
  <text x="680" y="155" class="text">No Remote Calls</text>
  
  <!-- Status Logic -->
  <rect x="630" y="180" width="100" height="45" fill="#E1F5FE" stroke="#03A9F4" stroke-width="1" rx="3"/>
  <text x="680" y="195" class="text" font-size="10">"Processing"</text>
  <text x="680" y="210" class="text" font-size="10">or "Failed"</text>
  
  <!-- Flow Arrows -->
  <!-- Customer Service to DB -->
  <line x1="110" y1="150" x2="110" y2="170" class="arrow"/>
  
  <!-- Customer Service to Stream -->
  <line x1="170" y1="110" x2="240" y2="110" class="event-arrow"/>
  <text x="205" y="105" class="text" font-size="10">Publish Event</text>
  
  <!-- Stream to Order Service -->
  <line x1="360" y1="110" x2="430" y2="110" class="event-arrow"/>
  <text x="395" y="105" class="text" font-size="10">Consume Event</text>
  
  <!-- Order Service to DB -->
  <line x1="490" y1="150" x2="490" y2="170" class="arrow"/>
  
  <!-- Order Service to Processing -->
  <line x1="550" y1="110" x2="620" y2="110" class="arrow"/>
  <text x="585" y="105" class="text" font-size="10">Process Order</text>
  
  <!-- Flow Labels -->
  <text x="110" y="260" class="text" font-size="11">1. Customer Action</text>
  <text x="300" y="260" class="text" font-size="11">2. Event Streaming</text>
  <text x="490" y="260" class="text" font-size="11">3. Data Sync</text>
  <text x="680" y="260" class="text" font-size="11">4. Order Creation</text>
  
  <!-- Benefits -->
  <text x="400" y="310" class="text" font-size="12" font-weight="bold">Benefits: Eventual Consistency + Service Independence</text>
  <text x="400" y="330" class="text" font-size="11">Order service doesn't need to call Customer service directly</text>
  <text x="400" y="350" class="text" font-size="11">Events provide reliable, ordered data synchronization</text>
</svg>